{%load static%}
<script src="https://kit.fontawesome.com/5a852abedd.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="{% static 'anadir_menu.css' %}">
<link rel="stylesheet" href="{% static 'styles.css' %}">

<div class = "cabecera">
	<div class = "contenedor-icono">
		{% load static %}
		<a href="{% url 'comandaGeneral' %}" ><i class="fa-solid fa-left-long"></i></a>
	
	</div>
	<h1>Clase {{profe.Letra}}: La clase de {{nombreProfesor}}</h1> 
	<div class = "fotos-laterales">
		<img src="../../../{{profe.FotoClase}}" alt="menu comedor" class ="fotoClase">
		<img src="../../../{{profe.FotoProfesor}}" alt="menu comedor" class ="fotoProfesor">
	</div>
	
</div>
<div class="content">
	<form method="POST" action ="" enctype="multipart/form-data">
		{% csrf_token %}
		{% for menu in menus %}
		<div class="menu">
			<h2 class="tipo" name = "tipoMenu">{{menu.Tipo}}</h2>
			<img src="../../../{{menu.Imagen}}" name="imagenMenu" class = "imagenMenu">
			{{form.Cantidad}}
			{%load static%}
			<img src="{% static 'menos.png' %}" name = "imagenMenos" class = "imagenMenos" onclick= "restarCantidad('{{ menu.Tipo }}')">
			{% for numero in numeros %}
			<img src="../../../{{numero.Imagen}}" name = "imagenNumero" class = "imagenNumero">
			{% endfor %}
			{%load static%}
			<img src="{% static 'mas.png' %}" id = "{{ menu.Tipo }}" class = "imagenMas" onclick = "sumarCantidad('{{ menu.Tipo }}')">
			
			{{solicitudes.TipoMenu}}
			
		</div>
		{% endfor %}
		<input type="submit" name ="prueba">
	</form>
	<div class = "flechas">
		<div class = "contenedor-icono2" id ="paginaAnterior" onclick="previousMenu()">
			<i class="fa-solid fa-left-long"></i>
			<span><u>Página anterior</u></span>
			
		</div>

		<div class = "contenedor-icono2" name ="paginaSiguiente" onclick="nextMenu()" >
			<span ><u>Página siguiente</u></span>
			<i class="fa-solid fa-right-long"></i>
		</div>
	</div>
</div>

<script>
	var cantidades = document.getElementsByName("Cantidad");
	var tipos = document.getElementsByName("tipoMenu");
	var fotos = document.getElementsByName("imagenMenu");
	var botonEnviar = document.getElementsByName("prueba");
	var imagenMas = document.getElementsByClassName("imagenMas");
	var imagenMenos = document.getElementsByName("imagenMenos");
    var tip = 0;
	botonEnviar.item(0).style.display = "none";
	var showHidden = 0;
	var cuentaPag = 0;
    var numeros = document.getElementsByName("imagenNumero");

    const ids = [];
    // itera por todos los menus disponibles

    ocultarMenus(true,0);

    function ocultarMenus(addIds,pagina){

        hideManos(pagina);
        for(let i = 0 ; i < imagenMas.length ; i++){
            if(addIds){
                ids.push(imagenMas.item(i).id);
            }
            toSet(cantidades,i,true);
            toSet(imagenMas,i,true);
            toSet(imagenMenos,i,true);
            toSet(fotos,i,true);
            toSet(tipos,i,true);
        }
        for(let i = pagina ; i < pagina+2 ; i++){
            toSet(cantidades,i,false);
            toSet(imagenMas,i,false);
            toSet(imagenMenos,i,false);
            toSet(fotos,i,false);
            toSet(tipos,i,false);
        }
    }

    function toCheck(a,pos){
        return pos >= 0 && pos < a.length;
    }
    function toSet(a,pos,isNone){
        if(toCheck(a,pos)){
             if(isNone){
                 a.item(pos).style.display = "none";
             }else{
                 a.item(pos).style.display = "inline";
             }

        }
    }



	function hideManos(pagina){
        for(let i = 0 ; i < numeros.length ; i++){
            toSet(numeros,i,true);
        }

        // 0 , 12 , 22 , 34

        let primer = pagina*2*12;

        let segundo = pagina*2*12+12;
        console.log(primer + " - "+segundo);
        toSet(numeros,primer,false);
        toSet(numeros,segundo,false);
    }


	function nextMenu() {
        tip++;
        if(tip >= tipos.length){
            tip = tipos.length-1;
        }
        ocultarMenus(false,tip);
	}

    function previousMenu(){
        tip--;
        if(tip < 0){
            tip = 0;
        }
        ocultarMenus(false,tip);
    }
	var vectorCantidades = [0,0,0,0,0,0];

	function sumarCantidad(tipoClicked) {
        let pos = ids.indexOf(tipoClicked);
        if(!toCheck(vectorCantidades,pos)) return;
        if(!toCheck(numeros,vectorCantidades[pos])) return;

        numeros.item(vectorCantidades[pos]).style.display = "none";
        vectorCantidades[pos]++;
        if(vectorCantidades[pos] >= numeros.length){
            vectorCantidades[pos] = numeros.length-1;
        }
        numeros.item(vectorCantidades[pos]).style.display = "inline";
        cantidades.item(pos).value=vectorCantidades[pos];

	}

	function restarCantidad(tipoClicked) {
        let pos = ids.indexOf(tipoClicked);
        if(!toCheck(vectorCantidades,pos))return;
        if(!toCheck(numeros,vectorCantidades[pos])) return;

        numeros.item(vectorCantidades[pos]).style.display = "none";
        vectorCantidades[pos]--;
        if(vectorCantidades[pos] < 0){
            vectorCantidades[pos] = 0;
        }
        numeros.item(vectorCantidades[pos]).style.display = "inline";
        cantidades.item(pos).value=vectorCantidades[pos];



	}

</script>